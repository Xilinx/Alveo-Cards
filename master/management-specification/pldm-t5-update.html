<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>PLDM IFWI Update &mdash; Satellite Controller  documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="SPDM Attestation" href="spdm-attestation.html" />
    <link rel="prev" title="PLDM Telemetry" href="pldm-t2-telemetry.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="index.html" class="icon icon-home"> Satellite Controller
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="oob-intro.html">Introduction</a></li>
</ul>
<p class="caption"><span class="caption-text">Alveo IPMI FRU</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="alveo-fru.html">Alveo™ FRU Support</a></li>
</ul>
<p class="caption"><span class="caption-text">PMCI support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pmci-support.html">PMCI Support</a></li>
</ul>
<p class="caption"><span class="caption-text">PLDM telemetry</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pldm-t2-telemetry.html">PLDM Telemetry</a></li>
</ul>
<p class="caption"><span class="caption-text">MA35D IFWI update</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">PLDM IFWI Update</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#pldm-type-5-over-mctp-over-smbus">PLDM Type-5 Over MCTP Over SMBus</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-b-firmware-scheme">A|B firmware scheme</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pldm-fw-update-process">PLDM FW update process</a></li>
<li class="toctree-l2"><a class="reference internal" href="#secure-fw-update">Secure FW update</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">SPDM attestation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="spdm-attestation.html">SPDM Attestation</a></li>
</ul>
<p class="caption"><span class="caption-text">Alveo I2C Telemetry</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="alveo-I2C-telemetry.html">Alveo I2C Telemetry</a></li>
</ul>
<p class="caption"><span class="caption-text">SC FW update</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sc-firmware-update.html">SC Firmware Update</a></li>
</ul>
<p class="caption"><span class="caption-text">U30 FPGA FW update</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="fpga-firmware-update.html">U30 FPGA FW update</a></li>
</ul>
<p class="caption"><span class="caption-text">PCIe and thermal info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="appendix-a.html">Appendix A</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="references.html">Additional Resources</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Satellite Controller</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>PLDM IFWI Update</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/pldm-t5-update.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="pldm-ifwi-update">
<h1>PLDM IFWI Update<a class="headerlink" href="#pldm-ifwi-update" title="Permalink to this headline">¶</a></h1>
<div class="section" id="pldm-type-5-over-mctp-over-smbus">
<h2>PLDM Type-5 Over MCTP Over SMBus<a class="headerlink" href="#pldm-type-5-over-mctp-over-smbus" title="Permalink to this headline">¶</a></h2>
<p><strong>Acronyms:</strong></p>
<ul class="simple">
<li>UA   - Update Agent (aka BMC)</li>
<li>FD   - Firmware Device (aka SC firmmare)</li>
<li>IFWI - Integrated Firmware Image</li>
</ul>
<p>In Alveo™ MA35D, SC supports IFWI updates via PLDM Over MCTP Over SMBus at slave address 0x30 (8-bit).  The IFWI is packaged following PLDM Type-5 bundle as described in the spec:</p>
<p><em>PLDM for FW Update Spec v1.0.0</em> (<a class="reference external" href="https://www.dmtf.org/dsp/DSP0267">[DSP0267]</a>)</p>
<p>Alveo™ MA35D IFWI has 3 distinct updatable firmware components:</p>
<ol class="arabic simple">
<li>ASIC: eSecure Firmware (128 KB)</li>
<li>ASIC: ZSP Firmware (124 KB)</li>
<li>SC Firmware (512 KB)</li>
</ol>
<p>Table: Supported PLDM Type-5 commands and description</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="36%" />
<col width="36%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Command Code</strong></th>
<th class="head"><strong>Command Name</strong></th>
<th class="head"><strong>Command Originator</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0x01</td>
<td>QueryDeviceIdentifiers</td>
<td>UA/BMC</td>
</tr>
<tr class="row-odd"><td>0x02</td>
<td>GetFirmwareParameters</td>
<td>UA/BMC</td>
</tr>
<tr class="row-even"><td>0x10</td>
<td>RequestUpdate</td>
<td>UA/BMC</td>
</tr>
<tr class="row-odd"><td>0x13</td>
<td>PassComponentTable</td>
<td>UA/BMC</td>
</tr>
<tr class="row-even"><td>0x14</td>
<td>UpdateComponent</td>
<td>UA/BMC</td>
</tr>
<tr class="row-odd"><td>0x15</td>
<td>RequestFirmwareData</td>
<td>FD/SC</td>
</tr>
<tr class="row-even"><td>0x16</td>
<td>TransferComplete</td>
<td>FD/SC</td>
</tr>
<tr class="row-odd"><td>0x17</td>
<td>VerifyComplete</td>
<td>FD/SC</td>
</tr>
<tr class="row-even"><td>0x18</td>
<td>ApplyComplete</td>
<td>FD/SC</td>
</tr>
<tr class="row-odd"><td>0x1A</td>
<td>ActivateFirmware</td>
<td>UA/BMC</td>
</tr>
<tr class="row-even"><td>0x1B</td>
<td>GetStatus</td>
<td>UA/BMC</td>
</tr>
<tr class="row-odd"><td>0x1C</td>
<td>CancelUpdateComponent</td>
<td>UA/BMC</td>
</tr>
<tr class="row-even"><td>0x1D</td>
<td>CancelUpdate</td>
<td>UA/BMC</td>
</tr>
</tbody>
</table>
<p>The following figure illustrates the PLDM firmware update bundle/package containing three firmware components.</p>
<img alt="_images/pldm_fw_bundle.png" class="align-center" src="_images/pldm_fw_bundle.png" />
<p><em>Figure:</em> PLDM firmware update bundle</p>
</div>
<div class="section" id="a-b-firmware-scheme">
<h2>A|B firmware scheme<a class="headerlink" href="#a-b-firmware-scheme" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>MA35D SC as well as ASIC supports A|B firmware scheme, where A is Active, and B is Backup.</li>
<li>In the steady state, images A &amp; B must be identical (i.e.) A == B. In other words, after the PLDM firmware update is completed, the firmware in partition A will be copied to partition B. This is done after the new firmware written to partition A boots up successfully.</li>
<li>Initially, the new firmware components, one at a time, are downloaded to staging area within SC’s flash memory.</li>
<li>After the verification of each firmware component, SC firmware copies the new firmware to the partition A within respective ASIC SPI flash.</li>
<li>After the new firmware from partition A boots-up successfully, SC copies that firmware image from partition A to partition B. This process is repeated for all firmware components.</li>
<li>ASIC flash has a reserved space of 512K to store the SC firmware, to enable in-band SC firmware update use-cases.</li>
</ul>
</div>
<div class="section" id="pldm-fw-update-process">
<h2>PLDM FW update process<a class="headerlink" href="#pldm-fw-update-process" title="Permalink to this headline">¶</a></h2>
<p>The following state diagram illustrates the PLDM firmware update process</p>
<img alt="_images/pldm_fw_update_flow.png" class="align-center" src="_images/pldm_fw_update_flow.png" />
<p><em>Figure:</em> PLDM firmware update flow - state diagram</p>
<p><strong>NOTE 1:</strong> Only the component(s) that need updating will be packaged. For exmaple, if there is no new eSecure FW when preparing a PLDM FW update bundle for new ZSP &amp; SC FW, the update bundle skips the eSecure FW.</p>
<p><strong>NOTE 2:</strong> All the updates are ‘forced’. In other words, if a FW component is packaged within the released PLDM bundle, that component will be force updated irrespective of the firmware version. There’s no version check in place and hence all PLDM updates will be treated as ‘forced’ updates.</p>
<p><strong>NOTE 3:</strong> Steps 3 through 8 below are repeated for all components within the FW update bundle - starting with eSecure FW, ZSP FW and finally the SC FW.</p>
<p><strong>PRE-UPDATE:</strong>
AMD delivers the firmware update bundle to the customer via secure means. Server BMC (aka UA) parsers PLDM bundle using the format specified as spec DSP0267 v1.0.0.</p>
<p>1.      <strong>INVENTORY COMMANDS:</strong>
BMC/UA initiates the firmware update process and queries meta-data about the firmware components from SC/FD via inventory commands 0x01 &amp; 0x02.</p>
<ol class="arabic simple" start="2">
<li><strong>REQUEST UPDATE &amp; COMPONENT INFO:</strong></li>
</ol>
<ol class="loweralpha simple">
<li><strong>REQUEST UPDATE:</strong> BMC requests SC to initiate new PLDM FW update process.</li>
<li><strong>PASS COMPONENT INFO:</strong> BMC sends necessary information about all firmware components contained in the FW update package.</li>
<li><strong>UPDATE COMPONENT:</strong> BMC sends this command to request update of a specific firmware component.</li>
</ol>
<p>3.      <strong>REQUEST FIRMWARE:</strong>
After receiving component info, SC sets up necessary receive buffers and then sends Request_Firmware command to BMC. BMC starts sending the firmware payload until end of file/component.</p>
<p>4.      <strong>TRANSFER COMPLETE:</strong>
SC notifies BMC after the component transfer is success.</p>
<p>5.      <strong>VERIFY COMPLETE:</strong>
SC verifies the firmware component against any tampering by using the public key stored in SC flash. Result is notified to BMC. See Secure FW update section below for details.</p>
<ol class="arabic simple" start="6">
<li><strong>APPLY:</strong></li>
</ol>
<ol class="loweralpha simple">
<li>After successful verification, SC copies the ASIC firmware (ZSP &amp; eSecure) images to its respective partition A in the SPI flash.</li>
<li>New SC FW stays in the MSP’s staging area of the flash. SC notifies the Bootloader of MSP to move the new SC binary from the staging area to partition A after reset/ACTIVATION is triggered.</li>
</ol>
<p>7.      <strong>APPLY COMPLTE:</strong>
SC notifies BMC about the apply complete status.</p>
<p>8.      <strong>ACTIVATE:</strong>
BMC sends this command to activate the new firmware component.</p>
<ol class="loweralpha simple">
<li>The SC features a self-contained activation method, enabling it to autonomously initiate an auto-reboot, transition to bootloader mode, and start up with the updated firmware. Alternatively, the new firmware can be activated upon the AC cycle during the maintenance window.</li>
<li>ASIC FW (both ZSP &amp; eSecure) are non-self-contained (i.e.) BMC must initiate AC cycle of the server to cold reset the ASICs in-order for the new FW to take effect.</li>
</ol>
<p><strong>GET_STATUS:</strong>
At any time, BMC can send Get_Status command to query the update status from SC.</p>
<p><strong>CANCEL UPDATE:</strong>
BMC has the option to cancel the update process - component specific (0x1C) or the entire update (0x1D) process. BMC shall issue one of these commands any time prior to sending ACTIVATE command.</p>
<ul class="simple">
<li>When the cancel command arrives before APPLY, SC/FD shall erase the firmware component from the MSP staging area in the flash.</li>
<li>On the other hand, when the cancel command arrives after APPLY, but before ACTIVATE, SC performs the restoration in the background (i.e.) by erasing the new component version ‘n+1’ from A and copying the current version ‘n’ from B to A.</li>
</ul>
<p><strong>NOTE:</strong> When busy servicing previous command from BMC or accessing ASIC SPI flash, SC shall respond <em>BUSY_IN_BACKGROUND</em> if BMC sends one of 0x1C or 0x1D cancel commands.</p>
<ol class="arabic simple" start="9">
<li>After the successful completion of PLDM FW update, ASIC boots-up with new FW and notifies SC about the boot status/success. SC subsequently performs a backup of A to B (i.e.) copies the newly update FW at A to partition B. After the copy, A == B.</li>
<li>After the successful completion of PLDM FW update, new SC firmware boots from location A. After deeming the new SC good, SC performs a backup of A to B (i.e.) copies the newly update FW at A to partition B. After the copy, A == B.</li>
<li>BMC can query the respective PLDM T2 firmware version sensor to identify whether the FW update process followed by the copy of A to B is success or not. SC keeps the ‘sensorOperationalState = Not-Enabled’ until both the update and backup are success. The goal is for both the flash partitions A &amp; B to have the new firmware version ‘n+1’ or rolledback to current firmware version ‘n’.</li>
</ol>
<p><strong>NOTE:</strong> SC shall send PLDM <em>NOT_READY</em> error code when BMC sends any PLDM Type-5 commands while SC is busy with one of the following scenario:</p>
<ul class="simple">
<li>Pervious pending firmware updates</li>
<li>Waiting for ASIC FW to boot-up</li>
<li>SPDM boot-up measurement</li>
<li>Another thread accessing SPI flash access</li>
</ul>
</div>
<div class="section" id="secure-fw-update">
<h2>Secure FW update<a class="headerlink" href="#secure-fw-update" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>MA35D OoB firmware update process uses signed/verified image scheme.</li>
<li>AMD applies digital signature to each firmware component at the build time using SHA3_384 and ECDSA_384. See figure below for details.</li>
<li><strong>DIGEST:</strong> For digest creation, firmware component payload and metadata are used. Metadata contains 3-byte component image size and 3-byte Security Version Number (SVN) to prevent replay attacks.</li>
<li><strong>ENCRYPT:</strong> One PPK pair (384-bit key size) is generated, and the same private key is used to sign/encrypt all 3 firmware components. The public key is stored within the SC flash.</li>
<li>The respective signature is appended to each firmware component and then the final PLDM firmware update package is created. See figure below for details.</li>
<li>Upon receiving each component, SC uses the stored public key to decrypt the signature and verifies the component against tamper and partial updates.</li>
</ul>
<p><strong>NOTE:</strong> No key rotation and revocation are supported in SC and there is no OTP (read-only) flash memory available within SC MCU to store the key securely.</p>
<p>The following diagram illustrates PLDM secure update process:</p>
<img alt="_images/pldm_secure_update_flow.png" class="align-center" src="_images/pldm_secure_update_flow.png" />
<p><em>Figure:</em> PLDM firmware package - secure update flow</p>
<p><strong>AMD Support</strong></p>
<p>For support resources such as answers, documentation, downloads, and forums, see the <a class="reference external" href="https://forums.xilinx.com/t5/Alveo-Accelerator-Cards/bd-p/alveo">Alveo Accelerator Cards AMD/Xilinx Community Forum</a>.</p>
<p><strong>License</strong></p>
<p>Licensed under the Apache License, Version 2.0 (the “License”); you may not use this file except in compliance with the License.</p>
<p>You may obtain a copy of the License at
<a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>All images and documentation, including all debug and support documentation, are licensed under the Creative Commons (CC) Attribution 4.0 International License (the “CC-BY-4.0 License”); you may not use this file except in compliance with the CC-BY-4.0 License.</p>
<p>You may obtain a copy of the CC-BY-4.0 License at
<a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an “AS IS” BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
<p align="center"><sup>XD038 | &copy; Copyright 2023, Advanced Micro Devices Inc.</sup></p></div>
</div>


           </div>
          </div>
          
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pldm-t2-telemetry.html" class="btn btn-neutral float-left" title="PLDM Telemetry" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="spdm-attestation.html" class="btn btn-neutral float-right" title="SPDM Attestation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2022, Xilinx, Inc..
      <span class="lastupdated">Last updated on March 30, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>